<configuration>

  <system.webServer>

    <!-- indicates that the index.js file is a node.js application 
    to be handled by the iisnode module -->
<modules>        
    <remove name="WebDAVModule" />    
  </modules>
    <handlers>
      <add name="iisnode" path="app.js" verb="*" modules="iisnode" />
    <add name="iisnode-socketio" path="app.js" verb="*" modules="iisnode" />
      <remove name="WebDAV" />    
    </handlers>

    <!-- use URL rewriting to redirect the entire branch of the URL namespace
    to index.js node.js application; for example, the following URLs will 
    all be handled by index.js:
    
        http://localhost/node/express/myapp/foo
        http://localhost/node/express/myapp/bar
        
    -->
<httpErrors errorMode="Detailed" existingResponse="PassThrough" />
    <rewrite>
      <rules>
        <rule name="api">
          <match url="/*" />
          <action type="Rewrite" url="app.js" />
        </rule>
        <rule name="SocketIO" patternSyntax="ECMAScript">
    <match url="socket.io.+"/>
    <action type="Rewrite" url="app.js"/>
</rule>
      </rules>
    </rewrite> 
    <directoryBrowse enabled="false"/>
        <webSocket enabled="false"/>
  </system.webServer>
</configuration>